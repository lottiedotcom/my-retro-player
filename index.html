<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WinPlay 98 - Pink Edition</title>
    <script src='https://cdn.jsdelivr.net/npm/tesseract.js@5/dist/tesseract.min.js'></script>
    <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
    <style>
        :root {
            /* Windows 98 Pink Theme */
            --win-bg: #e6e6e6;
            --win-gray: #c0c0c0;
            --win-dark: #808080;
            --win-light: #ffffff;
            --win-blue: #000080;
            --accent-pink: #ff0080;
            --accent-bar: linear-gradient(90deg, #ff0080, #800040);
        }

        body {
            background: #222;
            font-family: 'Tahoma', sans-serif;
            display: flex; flex-direction: column; align-items: center;
            padding: 10px; margin: 0; min-height: 100vh;
        }

        /* --- THE PLAYER (This is what we save) --- */
        #player-window {
            width: 340px;
            background: var(--win-gray);
            border: 2px solid;
            border-color: var(--win-light) var(--win-dark) var(--win-dark) var(--win-light);
            box-shadow: 10px 10px 0 rgba(0,0,0,0.5);
            padding: 2px;
            margin-bottom: 20px;
        }

        /* Title Bar */
        .title-bar {
            background: var(--accent-bar);
            color: white; padding: 3px; font-weight: bold; font-size: 11px;
            display: flex; justify-content: space-between; align-items: center;
            margin-bottom: 2px;
        }
        .win-btn-group { display: flex; gap: 2px; }
        .win-btn {
            width: 14px; height: 14px; background: var(--win-gray);
            border: 1px solid;
            border-color: var(--win-light) var(--win-dark) var(--win-dark) var(--win-light);
            font-size: 8px; line-height: 12px; text-align: center; color: black;
            box-shadow: none; padding: 0; cursor: default;
        }

        /* Main Display (LCD) */
        .lcd-panel {
            background: #000;
            border: 2px inset;
            border-color: var(--win-dark) var(--win-light) var(--win-light) var(--win-dark);
            margin: 4px; padding: 10px;
            color: #00ff00; font-family: 'Courier New', monospace;
            text-shadow: 0 0 3px #00ff00;
        }
        .lcd-main { font-size: 20px; white-space: nowrap; overflow: hidden; }
        .lcd-sub { font-size: 12px; color: #00aa00; margin-top: 5px; display: flex; justify-content: space-between; }

        /* Playlist Container */
        .playlist-frame {
            background: #fff;
            border: 2px inset;
            border-color: var(--win-dark) var(--win-light) var(--win-light) var(--win-dark);
            height: 180px;
            overflow-y: hidden; /* Hide scrollbar for clean photo */
            font-size: 11px;
            margin: 4px;
        }

        .pl-row {
            display: flex; padding: 3px 5px; border-bottom: 1px dotted #ccc;
            cursor: pointer;
        }
        .pl-row:hover { background: #ffccff; }
        .pl-row.active { background: var(--accent-pink); color: white; }
        
        .pl-num { width: 20px; }
        .pl-title { flex: 1; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
        .pl-time { width: 30px; text-align: right; }

        /* Chunk Controls */
        .controls {
            display: flex; justify-content: center; gap: 4px; padding: 6px;
        }
        .chunk-btn {
            background: var(--win-gray);
            border: 2px solid;
            border-color: var(--win-light) var(--win-dark) var(--win-dark) var(--win-light);
            padding: 5px 15px; font-size: 10px; font-weight: bold;
            cursor: pointer;
        }
        .chunk-btn:active { border-color: var(--win-dark) var(--win-light) var(--win-light) var(--win-dark); transform: translate(1px, 1px); }

        /* --- THE EDITOR TOOLS --- */
        #editor-panel {
            width: 340px; background: #333; color: white; padding: 10px;
            border: 1px solid #555;
        }
        
        .tool-btn {
            display: block; width: 100%; padding: 10px; margin-bottom: 10px;
            background: #ff0080; border: none; color: white; font-weight: bold; cursor: pointer;
        }
        
        /* The Cleanup List */
        #draft-list {
            background: #222; max-height: 150px; overflow-y: auto; 
            margin-bottom: 10px; border: 1px solid #555; display: none;
        }
        .draft-item {
            padding: 5px; border-bottom: 1px solid #444; display: flex; justify-content: space-between; font-size: 12px;
        }
        .del-btn { color: red; font-weight: bold; cursor: pointer; padding: 0 5px; }

    </style>
</head>
<body>

<div id="player-window">
    <div class="title-bar">
        <span>ðŸ’– WinPlay 98</span>
        <div class="win-btn-group">
            <button class="win-btn">_</button>
            <button class="win-btn">â–¡</button>
            <button class="win-btn">X</button>
        </div>
    </div>

    <div class="lcd-panel">
        <div class="lcd-main" id="lcd-text">READY...</div>
        <div class="lcd-sub">
            <span>STEREO</span>
            <span>128 KBPS</span>
            <span id="lcd-time">00:00</span>
        </div>
    </div>

    <div class="playlist-frame" id="final-list">
        <div class="pl-row active">
            <div class="pl-num">1.</div>
            <div class="pl-title" contenteditable="true">Tap "Import" below...</div>
            <div class="pl-time" contenteditable="true">3:45</div>
        </div>
        <div class="pl-row">
            <div class="pl-num">2.</div>
            <div class="pl-title" contenteditable="true">...to load your screenshot!</div>
            <div class="pl-time" contenteditable="true">2:10</div>
        </div>
    </div>

    <div class="controls">
        <button class="chunk-btn">PREV</button>
        <button class="chunk-btn">PLAY</button>
        <button class="chunk-btn">PAUSE</button>
        <button class="chunk-btn">STOP</button>
        <button class="chunk-btn">NEXT</button>
    </div>
</div>

<div id="editor-panel">
    <p style="margin:0 0 10px 0; font-size:12px;">ðŸ“¸ IMPORT PLAYLIST</p>
    
    <button class="tool-btn" onclick="document.getElementById('screen-input').click()">1. Upload Screenshot</button>
    <input type="file" id="screen-input" accept="image/*" style="display:none;" onchange="readImage(this)">
    
    <div id="status-msg" style="font-size:11px; color:yellow; margin-bottom:5px;"></div>
    <div id="draft-list">
        </div>

    <button class="tool-btn" style="background:#444;" onclick="pushToPlayer()">2. Update Player</button>
    <button class="tool-btn" style="background:#00aa00;" onclick="saveImage()">3. Save Image</button>
</div>

<script>
    let rawLines = [];

    // 1. READ IMAGE
    function readImage(input) {
        if (!input.files || !input.files[0]) return;
        
        const msg = document.getElementById('status-msg');
        msg.innerText = "â³ Scanning image... please wait...";
        document.getElementById('draft-list').style.display = 'block';

        Tesseract.recognize(
            input.files[0],
            'eng'
        ).then(({ data: { text } }) => {
            msg.innerText = "âœ… Done! Delete the junk below:";
            
            // Filter empty lines
            rawLines = text.split('\n').filter(l => l.trim().length > 1);
            
            renderDrafts();
        });
    }

    // 2. RENDER DRAFT LIST (For Cleanup)
    function renderDrafts() {
        const container = document.getElementById('draft-list');
        container.innerHTML = "";
        
        rawLines.forEach((line, index) => {
            const div = document.createElement('div');
            div.className = 'draft-item';
            div.innerHTML = `
                <span contenteditable="true" style="width:85%">${line}</span>
                <span class="del-btn" onclick="removeLine(${index})">X</span>
            `;
            container.appendChild(div);
        });
    }

    // 3. REMOVE LINE
    function removeLine(index) {
        rawLines.splice(index, 1);
        renderDrafts();
    }

    // 4. PUSH TO PLAYER
    function pushToPlayer() {
        // Re-read from the DOM in case user edited text
        const currentItems = document.querySelectorAll('.draft-item span:first-child');
        const finalList = document.getElementById('final-list');
        finalList.innerHTML = "";

        // If list is empty, don't crash
        if(currentItems.length === 0) return;

        // Set LCD to first track
        document.getElementById('lcd-text').innerText = "*** " + currentItems[0].innerText + " ***";

        currentItems.forEach((item, i) => {
            // Fake time gen
            const min = Math.floor(Math.random() * 3) + 2;
            let sec = Math.floor(Math.random() * 60);
            if(sec < 10) sec = "0" + sec;

            const row = `
            <div class="pl-row ${i === 0 ? 'active' : ''}">
                <div class="pl-num">${i + 1}.</div>
                <div class="pl-title" contenteditable="true">${item.innerText}</div>
                <div class="pl-time" contenteditable="true">${min}:${sec}</div>
            </div>`;
            finalList.innerHTML += row;
        });
        
        document.getElementById('draft-list').style.display = 'none';
        document.getElementById('status-msg').innerText = "âœ¨ Player Updated!";
    }

    // 5. SAVE
    function saveImage() {
        html2canvas(document.getElementById('player-window'), { scale: 3, backgroundColor: null }).then(canvas => {
            const link = document.createElement("a");
            link.download = "win98-playlist.png";
            link.href = canvas.toDataURL("image/png");
            link.click();
        });
    }
</script>

</body>
</html>

