<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RetroPod PWA</title>
    <link rel="manifest" href="manifest.json">
    <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
    <style>
        :root {
            --metal-gradient: linear-gradient(180deg, #dcdcdc 0%, #888 49%, #555 50%, #888 100%);
            --screen-bg: #000;
            --lcd-color: #00ff00;
            --btn-highlight: #e6e6e6;
        }

        body {
            background: #202020;
            font-family: 'Arial Narrow', sans-serif;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            min-height: 100vh; margin: 0; padding: 10px; box-sizing: border-box;
        }

        /* --- THE PLAYER CHASSIS --- */
        #player-skin {
            width: 100%;
            max-width: 360px;
            background: var(--metal-gradient);
            border-radius: 20px;
            padding: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.8), inset 0 0 10px rgba(255,255,255,0.5);
            border: 2px solid #aaa;
            position: relative;
        }

        /* Top Info Screen */
        .lcd-screen {
            background: #111;
            border: 4px inset #555;
            border-radius: 8px;
            padding: 10px;
            margin-bottom: 15px;
            box-shadow: inset 0 0 10px #000;
        }

        .track-scroller {
            white-space: nowrap; overflow: hidden;
            color: var(--lcd-color);
            font-family: 'Courier New', monospace;
            font-size: 14px; text-transform: uppercase;
            text-shadow: 0 0 5px var(--lcd-color);
            margin-bottom: 5px;
        }

        .time-display {
            font-family: 'Courier New', monospace;
            font-size: 28px; color: var(--lcd-color); font-weight: bold;
            text-align: right;
            text-shadow: 0 0 5px var(--lcd-color);
        }

        /* Album Art Window */
        .art-window {
            width: 100%;
            aspect-ratio: 1/1;
            background: #000;
            border: 3px inset #666;
            margin-bottom: 15px;
            position: relative;
            overflow: hidden;
            display: flex; align-items: center; justify-content: center;
        }

        #album-art {
            width: 100%; height: 100%;
            object-fit: cover;
            display: none; /* Hidden until loaded */
        }

        .placeholder-art {
            color: #444; font-size: 50px;
        }

        /* Controls */
        .controls-row {
            display: flex; justify-content: space-between; align-items: center;
            background: rgba(0,0,0,0.2);
            padding: 10px; border-radius: 50px;
            border: 1px solid rgba(255,255,255,0.2);
        }

        .btn {
            width: 50px; height: 50px;
            border-radius: 50%;
            border: none;
            background: radial-gradient(circle at 30% 30%, #fff, #999);
            box-shadow: 0 4px 6px rgba(0,0,0,0.5);
            cursor: pointer;
            font-size: 16px; display: flex; align-items: center; justify-content: center;
        }
        .btn:active { transform: scale(0.95); background: #777; }
        .btn-large { width: 65px; height: 65px; font-size: 24px; }

        /* Sliders / Inputs */
        #seek-bar { width: 100%; margin: 10px 0; cursor: pointer; }

        /* Hidden Inputs */
        .file-inputs {
            margin-top: 20px;
            background: #333; padding: 15px; border-radius: 10px; width: 100%;
            max-width: 360px; color: white; text-align: center;
        }
        
        .upload-btn {
            background: #444; color: white; border: 1px solid #777;
            padding: 10px; margin: 5px; width: 100%; cursor: pointer;
            text-transform: uppercase; font-size: 12px; letter-spacing: 1px;
        }
    </style>
</head>
<body>

<div id="player-skin">
    <div class="lcd-screen">
        <div class="track-scroller" id="track-name">NO DISC INSERTED...</div>
        <div class="time-display" id="timer">00:00</div>
    </div>

    <div class="art-window">
        <div class="placeholder-art" id="placeholder">‚ô™</div>
        <img id="album-art" src="" alt="Album Art">
    </div>

    <input type="range" id="seek-bar" value="0" min="0" step="1">

    <div class="controls-row">
        <button class="btn" onclick="stopAudio()">‚ñ†</button>
        <button class="btn btn-large" onclick="togglePlay()" id="play-btn">‚ñ∂</button>
        <button class="btn" onclick="takePhoto()">üì∑</button>
    </div>
</div>

<div class="file-inputs">
    <p style="margin:0 0 10px 0; font-size:12px; color:#aaa;">/// MEDIA LOADER ///</p>
    
    <label class="upload-btn">
        üìÇ Load Song (MP3)
        <input type="file" id="audio-input" accept="audio/*" style="display: none;">
    </label>
    
    <label class="upload-btn">
        üñºÔ∏è Load Cover Art
        <input type="file" id="image-input" accept="image/*" style="display: none;">
    </label>
</div>

<audio id="audio-player"></audio>

<script>
    const audioPlayer = document.getElementById('audio-player');
    const playBtn = document.getElementById('play-btn');
    const seekBar = document.getElementById('seek-bar');
    const trackName = document.getElementById('track-name');
    const timer = document.getElementById('timer');
    const albumArt = document.getElementById('album-art');
    const placeholder = document.getElementById('placeholder');

    // 1. Handle Audio Upload
    document.getElementById('audio-input').addEventListener('change', function(e) {
        const file = e.target.files[0];
        if (file) {
            const fileUrl = URL.createObjectURL(file);
            audioPlayer.src = fileUrl;
            trackName.innerText = file.name.replace(/\.[^/.]+$/, ""); // Remove extension
            trackName.style.animation = "marquee 5s linear infinite";
            timer.innerText = "00:00";
        }
    });

    // 2. Handle Image Upload
    document.getElementById('image-input').addEventListener('change', function(e) {
        const file = e.target.files[0];
        if (file) {
            const reader = new FileReader();
            reader.onload = function(event) {
                albumArt.src = event.target.result;
                albumArt.style.display = "block";
                placeholder.style.display = "none";
            }
            reader.readAsDataURL(file);
        }
    });

    // 3. Playback Controls
    function togglePlay() {
        if (audioPlayer.paused) {
            audioPlayer.play();
            playBtn.innerText = "||";
        } else {
            audioPlayer.pause();
            playBtn.innerText = "‚ñ∂";
        }
    }

    function stopAudio() {
        audioPlayer.pause();
        audioPlayer.currentTime = 0;
        playBtn.innerText = "‚ñ∂";
    }

    // 4. Update Timer & Seek Bar
    audioPlayer.addEventListener('timeupdate', () => {
        const current = audioPlayer.currentTime;
        const duration = audioPlayer.duration || 0;

        // Format Time
        let mins = Math.floor(current / 60);
        let secs = Math.floor(current % 60);
        if (secs < 10) secs = "0" + secs;
        timer.innerText = `${mins}:${secs}`;

        // Update Slider
        seekBar.value = (current / duration) * 100;
    });

    // Allow scrubbing
    seekBar.addEventListener('input', (e) => {
        const duration = audioPlayer.duration;
        audioPlayer.currentTime = (e.target.value / 100) * duration;
    });

    // 5. Save as Photo
    function takePhoto() {
        const element = document.getElementById('player-skin');
        html2canvas(element, { scale: 3, backgroundColor: null }).then(canvas => {
            let link = document.createElement("a");
            link.download = "now-playing.png";
            link.href = canvas.toDataURL("image/png");
            link.click();
        });
    }
</script>

</body>
</html>

